# Prediction API

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π REST API, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **FastAPI**, –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –Ω–∞ –±–∞–∑–µ OpenAI. –≠—Ç–æ—Ç API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –º–æ–¥–µ–ª—å—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è**:
   - –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/request` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å—ã —Å –¥–∞–Ω–Ω—ã–º–∏.
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥–µ–ª—å—é VseGPT –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - Middleware –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –∏—Ö —Ç–µ–ª–æ, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—ã.

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Å –∫–æ–¥–æ–º 400.
   - –ü—Ä–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–±–æ—è—Ö ‚Äî 500.

4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–æ–¥–µ–ª–∏**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç OpenAI –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ VseGPT –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **`main.py`** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI.
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.
  - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ `/api/request`.

- **`schemas/request.py`** ‚Äî —Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Ö–æ–¥–Ω—ã–µ –ø–æ–ª—è `id` –∏ `query` –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

- **`utils/logger.py`** ‚Äî –º–æ–¥—É–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone <—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
   cd <–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞>
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

bash
Copy
Edit
pip install -r requirements.txt
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

bash
Copy
Edit
uvicorn main:app --host 0.0.0.0 --port 8000
–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ API —Å –ø–æ–º–æ—â—å—é Postman –∏–ª–∏ curl:

bash
Copy
Edit
curl -X POST http://localhost:8000/api/request \
-H "Content-Type: application/json" \
-d '{"id": 1, "query": "–í–∞—à –≤–æ–ø—Ä–æ—Å"}'
üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
–°–æ–±–µ—Ä–∏—Ç–µ Docker-–æ–±—Ä–∞–∑:

bash
Copy
Edit
docker build -t prediction-api .
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

bash
Copy
Edit
docker run -d -p 8000:8000 --env-file .env prediction-api
API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000.

üåê –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã API
–ó–∞–ø—Ä–æ—Å:
json
Copy
Edit
POST /api/request
Content-Type: application/json

{
    "id": 1,
    "query": "–ö–∞–∫–æ–π –Ω–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —É –∫–∞—Ñ–µ–¥—Ä—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π?"
}
–û—Ç–≤–µ—Ç:
json
Copy
Edit
{
    "id": 1,
    "answer": 5,
    "reasoning": "–ö–∞—Ñ–µ–¥—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ ‚Ññ5",
    "sources": ["https://university.itmo.ru/info"]
}
üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ .env:

GPT_KEY ‚Äî –≤–∞—à API-–∫–ª—é—á –¥–ª—è VseGPT.
üìú –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
–ú–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

json
Copy
Edit
{
  "answer": <—á–∏—Å–ª–æ –∏–ª–∏ null>,
  "reasoning": "<–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ>",
  "sources": ["<—Å—Å—ã–ª–∫–∞1>", "<—Å—Å—ã–ª–∫–∞2>", "<—Å—Å—ã–ª–∫–∞3>"]
}
üõ†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

FastAPI ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è REST API.
Pydantic ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.
Uvicorn ‚Äî —Å–µ—Ä–≤–µ—Ä ASGI.
OpenAI ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API VseGPT.
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑:

bash
Copy
Edit
pip install -r requirements.txt
üìÇ –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
bash
Copy
Edit
‚îú‚îÄ‚îÄ main.py               # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îî‚îÄ‚îÄ request.py        # –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ logger.py         # –õ–æ–≥–≥–µ—Ä –¥–ª—è –∑–∞–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt      # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ Dockerfile            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Docker
‚îú‚îÄ‚îÄ .env                  # –§–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
